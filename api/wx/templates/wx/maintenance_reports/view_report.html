{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://cdn.jsdelivr.net/npm/vuetify@3.7.3/dist/vuetify.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font/css/materialdesignicons.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/vue@3.5.12/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify@3.7.3/dist/vuetify.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    .srf-display-1 {font-size: 2em;}
    .srf-display-2 {font-size: 1.3em; color: #4d4d4d;}
    #download-area {
      width: 210mm; /* A4 width */
      margin: auto;
    }
  </style>
</head>
<body>
  <main>
    <div id="app">
      <v-app>
        <v-container>
          <div id="download-area">
            <v-row class="text-center">
              <v-col cols="12"> <img src="{% static "images/nms_logo.png" %}" alt="Logo"> </v-col>
              <v-col cols="12"> <span class="srf-display-1 text-uppercase">Manual Weather Station Maintenance Report</span> </v-col>
              <v-col cols="12"> <span class="srf-display-1 text-uppercase font-weight-bold">{{ station_information.station_name }}</span> </v-col>
            </v-row>

            </br></br> </br></br>  <hr>
            <v-row>
              <v-col cols="12"> <span class="srf-display-2 text-uppercase">Visit Summary Information</span> </v-col>
            </v-row>
            <v-row style="background-color: #CCC">
                <v-col cols="3"> Report #:</v-col>
                <v-col cols="3"> {{ visit_summary_information.report_number }}" </v-col>
                <v-col cols="3"> Responsible Technicians:</v-col>
                <v-col cols="3"> {{ visit_summary_information.responsible_technician }} </v-col>
            </v-row>
            <v-row>
                <v-col cols="3"> Date of Visit:</v-col>
                <v-col cols="3"> {{ visit_summary_information.date_of_visit }} </v-col>
                <v-col cols="3"> Date of Next Visit:</v-col>
                <v-col cols="3"> {{ visit_summary_information.date_of_next_visit }} </v-col>
            </v-row>
            <v-row style="background-color: #CCC">
                <v-col cols="3"> Start Time:</v-col>
                <v-col cols="3"> {{ visit_summary_information.start_time }} </v-col>
                <v-col cols="3"> Other Technicians:</v-col>
                <v-col cols="3"> {{ visit_summary_information.other_technicians }} </v-col>
            </v-row>
            <v-row>
                <v-col cols="3"> End Time:</v-col>
                <v-col cols="3"> {{ visit_summary_information.end_time }} </v-col>
                <v-col cols="3"> Type of Visit:</v-col>
                <v-col cols="3"> {{ visit_summary_information.type_of_visit }} </v-col>
            </v-row>
            <v-row style="background-color: #CCC">
                <v-col cols="3"> Description of Station Upon Arrival:</v-col>
                <v-col cols="9"> {{ visit_summary_information.station_on_arrival_conditions | safe }} </v-col>
            </v-row>
            <v-row>     
                <v-col cols="3"> Summary of Work Done at Station:</v-col>
                <v-col cols="9"> {{ visit_summary_information.current_visit_summary | safe }} </v-col>
            </v-row>
            <v-row style="background-color: #CCC">    
                <v-col cols="3"> Work To Be Done On Next Visit:</v-col>
                <v-col cols="9"> {{ visit_summary_information.next_visit_summary | safe }}</v-col>
            </v-row>
              
            </br></br> </br></br>  <hr>
            <v-row>
              <v-col cols="12"> <span class="srf-display-2 text-uppercase">Station Information</span> </v-col>
            </v-row>

            <v-row style="background-color: #CCC">
                <v-col cols="3"> Station Name: </v-col>
                <v-col cols="3"> {{station_information.station_name}} </v-col>
                <v-col cols="3"> Station Host Name: </v-col>
                <v-col cols="3"> {{station_information.station_host_name}} </v-col>
            </v-row>  
            <v-row style="background-color: #FFF">
                <v-col cols="3"> Sttion ID: </v-col>
                <v-col cols="3"> {{station_information.station_ID}} </v-col>
                <v-col cols="3"> WIGOS ID: </v-col>
                <v-col cols="3"> {{station_information.wigos_ID}} </v-col>
            </v-row>
            <v-row style="background-color: #CCC">
                <v-col cols="3"> Sttion Type: </v-col>
                <v-col cols="3"> {{station_information.station_type}} </v-col>
                <v-col cols="3"> Sttion Profile: </v-col>
                <v-col cols="3"> {{station_information.station_profile}} </v-col>
            </v-row>  
            <v-row style="background-color: #FFF">
                <v-col cols="3"> Latitude: </v-col>
                <v-col cols="3"> {{station_information.latitude}} </v-col>
                <v-col cols="3"> Elevation (m): </v-col>
                <v-col cols="3"> {{station_information.elevation}} </v-col>
            </v-row>
            <v-row style="background-color: #CCC">
                <v-col cols="3"> Longitude: </v-col>
                <v-col cols="3"> {{station_information.longitude}} </v-col>
                <v-col cols="3"> District: </v-col>
                <v-col cols="3"> {{station_information.district}} </v-col>
            </v-row>  
            <v-row style="background-color: #FFF">
                <v-col cols="3"> Transmission Type: </v-col>
                <v-col cols="3"> {{station_information.transmission_type}} </v-col>
                <v-col cols="3"> Transmission ID: </v-col>
                <v-col cols="3"> {{station_information.transmission_ID}} </v-col>
            </v-row>
            <v-row style="background-color: #CCC">
                <v-col cols="3"> Transmission Interval: </v-col>
                <v-col cols="3"> {{station_information.transmission_interval}} </v-col>
                <v-col cols="3"> Measurement Interval: </v-col>
                <v-col cols="3"> {{station_information.measurement_interval}} </v-col>
            </v-row>  
            <v-row style="background-color: #FFF">
                <v-col cols="3"> Date of First Operation: </v-col>
                <v-col cols="3"> {{station_information.data_of_first_operation}}</v-col>
                <v-col cols="3"> Date(s) of Relocation: </v-col>
                <v-col cols="3"> {{station_information.data_of_relocation}} </v-col>
            </v-row>

            </br></br> </br></br>  <hr>
            <v-row>
              <v-col cols="12"> <span class="srf-display-2 text-uppercase">Contact Information</span> </v-col>
            </v-row>

            <v-row>
              <v-col cols="12"> <span> {{ contact_information | safe }} </span> </v-col>
            </v-row>

            </br></br> </br></br>  <hr>
            <v-row>
              <v-col cols="12"> <span class="srf-display-2 text-uppercase">Equipment Record</span> </v-col>
            </v-row>

            <v-row v-for="equipment_record in {{equipment_records}}" column>
              <v-col cols="12">
                <v-row style="background-color: #CCC">
                  <v-col cols="12">  <span> Component Condition </span> </v-col>
                </v-row>
                <v-row>
                  <v-col cols="12"> <span v-html="equipment_record.condition"></span> </v-col>
                </v-row>
                <v-row style="background-color: #CCC">
                  <v-col cols="12">  <span> Component Classification </span> </v-col>
                </v-row>
                <v-row>
                  <v-col cols="12">
                    <div class="py-2">
                      <v-row>
                        <v-col cols="12" class="d-flex align-center">
                          <input type="radio" disabled :checked="equipment_record.component_classification==='F'" style="width: 20px; height: 20px;">
                          <span class="text-subtitle-1 ml-2"> Fully Functional </span>
                        </v-col>
                      </v-row>
                      <v-row>
                        <v-col cols="12" class="d-flex align-center">
                          <input type="radio" disabled :checked="equipment_record.component_classification==='P'" style="width: 20px; height: 20px;">
                          <span class="text-subtitle-1 ml-2"> Partially Functional </span>
                        </v-col>
                      </v-row>
                      <v-row>
                        <v-col cols="12" class="d-flex align-center">
                          <input type="radio" disabled :checked="equipment_record.component_classification==='N'" style="width: 20px; height: 20px;">
                          <span class="text-subtitle-1 ml-2"> Not Functional </span>
                        </v-col>
                      <v-row>
                    </div>                    
                  </v-col>
                </v-row>
              <v-col>
            </v-row>
          </div>
          <v-row class="mt-5 justify-center">
            <v-col cols="3"  class="text-center">
              <v-btn color="primary" :href="updateMaintenanceReport()">Close Preview</v-btn>
            </v-col>
            <v-col cols="3" class="text-center">
                <v-btn color="primary" @click="downloadPDF" append-icon="mdi-download">Download PDF</v-btn>
            </v-col>         
          </v-row>
        </v-container>
      </v-app>
    </div>
  </main>
  <script>
    const { createApp } = Vue;
    const { createVuetify } = Vuetify;
    const vuetify = createVuetify();
    const {jsPDF} = window.jspdf
    createApp({
      data() {
        return {
          maintenance_report_id: "{{ visit_summary_information.report_number }}",
          maintenance_report_status: "{{ visit_summary_information.maintenance_report_status }}",
          source: "{{ source }}",
        };
      },
      methods: {
        updateMaintenanceReport() {
          return (this.maintenance_report_status === "A" || this.source === "list") 
            ? `/wx/maintenance_report/` 
            : `/wx/maintenance_report/${this.maintenance_report_id}/update/`;
        },
        downloadPDF() {
          const filename = `Maintenance_Report_${this.maintenance_report_id}.pdf`;
          const pdf = new jsPDF({
            orientation: 'portrait',
            unit: 'mm',
            format: 'a4'
          });
        
          pdf.html(document.getElementById('download-area'), {
            callback: function (doc) {
              doc.save(filename);
            },
            x: 10,
            y: 10,
            width: 190, // A4 width is 210mm, leaving 10mm margins on each side
            windowWidth: document.getElementById('download-area').scrollWidth,
            autoPaging: 'text'
          });
        },
      },
    }).use(vuetify).mount("#app");
  </script>
</body>
</html>
